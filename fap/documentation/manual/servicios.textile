h1. Servicios

A partir de la versi贸n 2.0 de FAP, los servicios se implementan mediante inyecci贸n de dependencias, utilizando Google Guice. Para m谩s infomaci贸n "aqu铆.":http://www.playframework.org/modules/guice sta implementaci贸n facilita la depuraci贸n, cambio de implementaciones, ...

Ahora tanto la seguridad en los permisos como los servicios que utiliza FAP (GestorDocumental, Firma, Registro, Notificaciones, ...) utilizan esta inyecci贸n de dependencias. Pero... _驴qu茅 es lo que nos permite hacer la inyecci贸n de dependencias?_. F谩cil: Nosotros definimos la interfaz de un servicio, y tu en tu aplicaci贸n puedes utilizar la implementaci贸n que desees oportuna, alguna de las disponibles en el m贸dulo FAP o cualquieras que tu quieras implementar.

Utilizando la clase *AppModule* configuramos los diferentes servicios que utilizaremos. Esta clase hereda de la configuraci贸n que est谩 definida en el m贸dulo donde se declaran todos los servicios.

_驴No me puedes poner un ejemplo?_ ... Por supuesto. Uno de los servicios es el *GestorDocumentalService*. Las aplicaciones que utilizan FAP deben tener un gestor documental donde guardar los documentos que se suban a la aplicaci贸n o que se generen por la misma, as铆 que tenemos definida en el m贸dulo la interfaz de ese Gestor Documental.

 
bc. public interface GestorDocumentalService {
    public void configure() throws GestorDocumentalServiceException;
    public boolean isConfigured();
    public String crearExpediente(SolicitudGenerica solicitud) throws GestorDocumentalServiceException;
    public List<String> getDocumentosEnExpediente(String expediente) throws GestorDocumentalServiceException;
    public List<models.Documento> getDocumentosPorTipo(String tipoDocumento) throws AedExcepcion;
    public BinaryResponse getDocumento(Documento documento) throws GestorDocumentalServiceException;
    public String saveDocumentoTemporal(models.Documento documento, InputStream inputStream, String filename)
            throws GestorDocumentalServiceException;
    public String saveDocumentoTemporal(models.Documento documento, File file) throws GestorDocumentalServiceException;
    public void updateDocumento(Documento documento) throws GestorDocumentalServiceException;
    public void deleteDocumento(Documento documento) throws GestorDocumentalServiceException;
    public void clasificarDocumentos(SolicitudGenerica solicitud, List<models.Documento> documentos,
            InformacionRegistro informacionRegistro, boolean notificable) throws GestorDocumentalServiceException;
    public void clasificarDocumentos(SolicitudGenerica solicitud, List<models.Documento> documentos,
            InformacionRegistro informacionRegistro) throws GestorDocumentalServiceException;
    public void clasificarDocumentos(SolicitudGenerica solicitud, List<models.Documento> documentos)
            throws GestorDocumentalServiceException;
    public void clasificarDocumentos(SolicitudGenerica solicitud, List<models.Documento> documentos, boolean notificable)
            throws GestorDocumentalServiceException;
    public void agregarFirma(Documento documento, Firma firma) throws GestorDocumentalServiceException;
    public Firma getFirma(Documento documento) throws GestorDocumentalServiceException;
    public List<Tramite> getTramites() throws GestorDocumentalServiceException;
    public void actualizarCodigosExclusion();
    public List<TipoDocumentoEnTramite> getTiposDocumentosAportadosCiudadano (models.Tramite tramite);
    // Devuelve la expresi贸n regular que queremos que case con parte de la URI del tr谩mite de la verificaci贸n, para componer el nombre de la plantilla que se utilizar谩 como cabecera del PDF del requerimiento.
    public String getExpReg();
    public List<TipoDocumento> getListTiposDocumentosAportadosCiudadano (models.Tramite tramite);
	 String crearExpediente(ExpedienteAed expedienteAed) throws GestorDocumentalServiceException;
	 String modificarInteresados(ExpedienteAed expedienteAed, SolicitudGenerica solicitud) throws GestorDocumentalServiceException;
    BinaryResponse getDocumentoByUri(String uriDocumento) throws GestorDocumentalServiceException;
	 public void duplicarDocumentoSubido(String uriDocumento, SolicitudGenerica solicitud) throws AedExcepcion, GestorDocumentalServiceException;
}


Y tambi茅n tenemos definida dos implementaciones (las cuales no incluiremos todo el codigo aqu铆 por el tama帽o del mismo) AedGestorDocumentalServiceImpl y FileSystemGestorDocumentalServiceImpl. El primero utiliza un AED como gestor documental, que se deber谩 configurar correctamente en las properties; mientras que el segundo utiliza el sistema de ficheros local como gestor documental.

Como vimos anteriormente, la configuraci贸n se hereda del m贸dulo FAP, y la configuraci贸n en el m贸dulo es la siguiente:

bc. protected void gestorDocumental() {
	bindLazySingletonOnDev(GestorDocumentalService.class, FileSystemGestorDocumentalServiceImpl.class);
}

Vemos que utiliza el gestor documental del sistema de ficheros, pero... 驴y si queremos que utilice el AED (qu ya configuramos todas sus properties en el fichero _application.conf_)? Pues simplemente en nuestra aplicaci贸n, en el fichero _AppModule.java_ har铆amos algo como lo siguiente:

bc. public class AppModule extends FapModule {
    @Override
    protected void gestorDocumental() {
       bindLazySingletonOnDev(GestorDocumentalService.class, AedGestorDocumentalServiceImpl.class);
    }
}

Y ya autom谩ticamente nuestra aplicaci贸n utilizar铆a el AED. Evidentemente, si nosotros queremos utilizar otro gestor documental en la aplicaci贸n simplemente tendremos que crear otra implementaci贸n de la interfaz *GestorDocumentalService.java* y configurarla de la misma manera en la aplicaci贸n.

Un esquema que complementa la anterior explicaci贸n es el siguiente:

!images/gestorDocumentalService!

Vemos que el mdulo FAP tiene 2 implementaciones del servicio, y nuestra aplicacin puede a su vez tener todas las implementaciones que queramos y usaremos la que configuremos en el _AppModule.java_.