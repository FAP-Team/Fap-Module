%{
// Obtenemos al ultima solicitud, sobre la que trabajamos
models.Solicitud s = models.Solicitud.all().fetch().get((int)models.Solicitud.count()-1);

play.mvc.Controller.session.put("username", "admin");
controllers.fap.AgenteController.findAgente();
}%

#{selenium}
    open(/Principal/solicitudes)
    waitForPageToLoad()
    pause(1000)   // Necesaria para la carga de solicitudes
    open('/Solicitud/solicitantepfcamposno?idSolicitud=${s.id}&accion=editar')
    waitForPageToLoad()
    clickAndWait('link=Documentación FAP')
    clickAndWait('//button')
    select('id=documento_tipo','label=Aportación de la solicitud')
%{
if (properties.FapProperties.getBoolean("fap.metadatos.activo")) {
}%
        assertElementPresent('id=botonRellenarMetadatos')
        click('id=botonRellenarMetadatos')
        waitForElementPresent('id=BotonGuardarPopupMetadatos')
        type('id=metadatos_nombre','valor22')
        click('id=BotonGuardarPopupMetadatos')
        assertElementPresent('css=#formHiddenMetadatos>input:nth-child(1)','valor22')
        waitForElementPresent('css=input.btn.default')
        click('css=input.btn.default')
        waitForPageToLoad()
        waitForText('css=div.alert.alert-error','*Error al guardar. La página contiene errores.*')
        click('link=Ver detalles')
        assertNotText('css=div.alert.alert-error>ul','*El metadato * no tiene un valor válido*')
        //Valor no valido
        click('id=botonRellenarMetadatos')
        waitForElementPresent('id=BotonGuardarPopupMetadatos')
        type('id=metadatos_nombre','valorNoValido')
        click('id=BotonGuardarPopupMetadatos')
        assertElementPresent('css=#formHiddenMetadatos> input:nth-child(1)','valorNovalido')
        waitForElementPresent('css=input.btn.default')
        click('css=input.btn.default')
        waitForPageToLoad()
        waitForText('css=div.alert.alert-error','*Error al guardar. La página contiene errores. Ver detalles*')
        click('link=Ver detalles')
        waitForText('css=div.alert.alert-error>ul','*El metadato * no tiene un valor válido*')



%{} else {}%
        assertElementNotPresent('id=botonRellenarMetadatos')
%{}}%
#{/selenium}

