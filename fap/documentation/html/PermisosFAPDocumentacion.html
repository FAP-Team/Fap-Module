<body>  <div id="container">    <div id="background"></div>    <table cellpadding="0" cellspacing="0">      <thead>        <tr>          <th class="docs">            <h1>            	<h2>              		PermisosFAPDocumentacion            	</h2>            </h1>          </th>          <th class="code">          </th>        </tr>      </thead>      <tbody>                                    <tr id="section-1">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-1">&#182;</a>              		</div>                 	<p>Permisos de administracion</p>            	 	</td>            	<td class="code">            		<pre>Permiso administrador{<br/>	when<br/>		agente.rolActivo = "administrador"<br/>	return all<br/>}<br/><br/>Permiso usuario{<br/>	when<br/>		agente.rolActivo = "usuario"<br/>	return all<br/>}<br/><br/>Permiso noUsuario{<br/>	when<br/>		agente.rolActivo != "usuario"<br/>	return all<br/>}<br/><br/>Permiso logeado{<br/>	when <br/>		agente != null<br/>	return all<br/>}<br/>              		</pre>            	</td>          </tr>                            <tr id="section-2">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-2">&#182;</a>              		</div>                 	<p>Permisos de la pag presentacion</p>            	 	</td>            	<td class="code">            		<pre>Permiso presentacionPrepararParaFirmar{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "usuario") and<br/>		solicitud?.registro.fasesRegistro.borrador = "false"<br/>	return editable<br/><br/>	when<br/>		agente.rolActivo in ("administrador", "usuario")<br/>	return visible<br/>}<br/><br/>Permiso presentacionModificar{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		solicitud?.registro.fasesRegistro.registro = "false"<br/>	return editable<br/><br/>	else<br/>	return visible		<br/>}<br/><br/>Permiso presentacionObtenerBorrador{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "usuario") and<br/>		solicitud?.registro.fasesRegistro.borrador = "true"<br/>	return editable<br/>}<br/><br/>Permiso presentacionFirmar{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "usuario") and <br/>		solicitud?.registro.fasesRegistro.borrador = "true" and<br/>		solicitud.registro.fasesRegistro.firmada = "false"<br/>	return editable<br/><br/>	when<br/>		agente.rolActivo in ("administrador", "usuario") and<br/>		solicitud?.registro.fasesRegistro.borrador = "true"<br/>	return visible<br/>}<br/><br/>Permiso presentacionRegistrar{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		solicitud?.registro.fasesRegistro.firmada = "true" and<br/>		(<br/>			agente.rolActivo = "usuario" and<br/>			solicitud.registro.fasesRegistro.registro = "false"<br/>		) or<br/>		(<br/>			agente.rolActivo = "administrador" and<br/>			solicitud.registro.fasesRegistro.clasificarAed = "false"<br/>		)<br/>	return editable<br/><br/>	when<br/>		solicitud?.registro.fasesRegistro.firmada = "true"<br/>	return visible	<br/>}<br/><br/>Permiso presentacionRecibo{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "usuario") and<br/>		solicitud?.registro.fasesRegistro.registro = "true"<br/>	return editable	<br/>}	<br/><br/>Permiso instruccion{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		solicitud?.estado = "iniciada"<br/>	return editable		<br/>}<br/><br/>Permiso solicitudPreparadaFirmarYPresentar{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "usuario") and<br/>		solicitud?.estado = "borrador" and<br/>		solicitud.registro.fasesRegistro.borrador = "true"<br/>	return all<br/><br/>	when<br/>		agente.rolActivo in ("administrador", "usuario")<br/>	return leer<br/>}<br/><br/>Permiso editableSiSolicitudIniciada{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		solicitud?.estado in ("Iniciada", "Requerida", "Requerida plazo vencido", "En verificación", "Pendiente requerimiento", "Excluido", "Plazo vencido", "Verificado")<br/>	return all<br/>}<br/><br/>Permiso solicitudPreparadaFirmar{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "usuario") and<br/>		solicitud?.estado = "borrador"  and<br/>		solicitud.registro.fasesRegistro.borrador != null and<br/>		solicitud.registro.fasesRegistro.borrador = "true"<br/>	return all<br/><br/>	when<br/>		agente.rolActivo in ("administrador", "usuario")<br/>	return leer<br/>}<br/><br/>Permiso solicitudPreparadaPresentar{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "usuario") and<br/>		solicitud?.estado = "borrador" and<br/>		solicitud.registro.fasesRegistro.borrador != null and<br/>		solicitud.registro.fasesRegistro.borrador = "true" and<br/>		solicitud.registro.fasesRegistro.firmada = "true"<br/>	return all<br/><br/>	when<br/>		agente.rolActivo in ("administrador", "usuario")<br/>	return leer<br/>}<br/>              		</pre>            	</td>          </tr>                            <tr id="section-3">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-3">&#182;</a>              		</div>                 	<p>Permiso que define las solicitudes que son visibles para el usuario</p>            	 	</td>            	<td class="code">            		<pre>Permiso solicitudes{<br/>	mensaje = "No tiene suficientes privilegios para acceder a esta solicitud"<br/>	vars<br/>		SolicitudGenerica solicitud<br/>		Participacion participacion : sql("select p from Participacion p where p.agente=? AND p.solicitud=?", agente, solicitud)<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor")<br/>		or<br/>		participacion != null 			<br/>	return all<br/>}<br/>              		</pre>            	</td>          </tr>                            <tr id="section-4">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-4">&#182;</a>              		</div>                 	<p>Permisos pagina de presentacion</p>            	 	</td>            	<td class="code">            		<pre>              		</pre>            	</td>          </tr>                            <tr id="section-5">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-5">&#182;</a>              		</div>                 	            	 	</td>            	<td class="code">            		<pre>Permiso adminGestorRevisor{<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor")<br/>	return editable<br/>}<br/><br/>Permiso aportacion{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when <br/>		agente.rolActivo in ("administrador", "usuario", "gestor", "revisor") and<br/>		solicitud?.estado in ("iniciada", "requerida", "verificado")<br/>	return all<br/>}<br/><br/>Permiso aportacionDocumentos{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "usuario", "gestor", "revisor") and<br/>		solicitud?.estado in ("iniciada", "requerida", "requerida plazo vencido")<br/>	return editable<br/>}<br/><br/>Permiso noEditable{<br/>	return visible<br/>}<br/><br/>Permiso noVisibleUsuario{<br/>	when<br/>		usuario is visible<br/>	return denegar<br/>	else return all<br/>}<br/><br/>Permiso solicitudEnBorrador{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		solicitud?.estado = "borrador"	<br/>	return all<br/>}<br/><br/>Permiso editarSolicitud{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		!usuario is visible<br/>		or (<br/>	 		agente.rolActivo = "usuario" and<br/>	 		solicitud?.estado = "borrador" and<br/>	 		solicitud.registro.fasesRegistro.borrador = "false"<br/>		)<br/>	return [editar leer]<br/>	when<br/>		!usuario is visible<br/>		or (<br/>	 		agente.rolActivo = "usuario" and<br/>	 		solicitud.estado = "borrador"<br/>		)<br/>	return [leer]<br/>}<br/><br/><br/>Permiso participacionEnSolicitud {<br/>	vars<br/>		SolicitudGenerica solicitud<br/>		Participacion participacion : sql("select p from Participacion p where p.agente=? AND p.solicitud=?", agente, solicitud)<br/>	when<br/>		participacion != null<br/>	return all<br/>}<br/>              		</pre>            	</td>          </tr>                            <tr id="section-6">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-6">&#182;</a>              		</div>                 	<p>Indica el permiso que se tiene sobre la solicitud + Administrador: editable + usuario con participación: editable + resto: none</p>            	 	</td>            	<td class="code">            		<pre>Permiso permisoSolicitud {<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		administrador contains _accion<br/>	return all<br/><br/>	when<br/>		participacionEnSolicitud contains _accion<br/>	return all<br/>}<br/>              		</pre>            	</td>          </tr>                            <tr id="section-7">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-7">&#182;</a>              		</div>                 	<p>Este permiso lo tienen todas las páginas de la solicitud Controla que los datos no se puedan editar cuando la solicitud está preparada para registrar</p>            	 	</td>            	<td class="code">            		<pre>Permiso solicitud {<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		administrador contains _accion<br/>	return editar<br/><br/>	when<br/>		participacionEnSolicitud contains _accion and<br/>	 	agente.rolActivo = "usuario" and<br/>	 	solicitud?.estado = "borrador" and<br/>	 	solicitud.registro.fasesRegistro.borrador = "false"<br/>	return editar<br/><br/>	when<br/>		participacionEnSolicitud contains _accion<br/>	return leer<br/>}<br/><br/>Permiso subirDocumentos{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		administrador contains _accion<br/>		or (<br/>	 		solicitud?.estado = "borrador" and<br/>	 		solicitud.registro.fasesRegistro.borrador = "false"<br/>		)<br/>	return crear<br/>}<br/><br/>Permiso visibleSiAccesoCertificado{<br/>	when <br/>		agente.acceso = "certificado"<br/>	return all<br/>}<br/><br/>Permiso visibleSiAccesoContrasena{<br/>	when <br/>		agente.acceso = "usuario"<br/>	return all<br/>}<br/><br/>Permiso documentoAutorizacionGenerado{<br/>	vars <br/>		SolicitudGenerica solicitud<br/>	when <br/>		solicitud?.registro.autorizacionFuncionario.urlDescarga != null and<br/>		agente.funcionario != "true"<br/>	return all<br/>}<br/><br/>Permiso visibleFuncionarioAutorizado{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when <br/>		agente.funcionario = "true" and<br/>		solicitud?.solicitante.autorizaFuncionario = "true"<br/>	return all<br/>}<br/><br/>Permiso noVisibleFuncionarioAutorizado{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when <br/>		agente.funcionario = "true" and<br/>		solicitud?.solicitante.autorizaFuncionario = "true"<br/>	return all<br/>}<br/>              		</pre>            	</td>          </tr>                            <tr id="section-8">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-8">&#182;</a>              		</div>                 	<p>/* Se puede moficicar la aportación de documentación cuando está en borrador*/	</p>            	 	</td>            	<td class="code">            		<pre>Permiso aportacionModificar{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		solicitud?.aportaciones.actual.estado in ("borrador")<br/>	return editable<br/>}	<br/>              		</pre>            	</td>          </tr>                            <tr id="section-9">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-9">&#182;</a>              		</div>                 	<p>/*   Cuando la firma y registro se quedo en un paso intermedio. Se le muestra un mensaje   al usuario diciendole que hubo un problema, que pulse otra vez el problema para   completar el registro  </p>            	 	</td>            	<td class="code">            		<pre>Permiso aportacionMensajeIntermedio{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		solicitud?.aportaciones.actual.estado in ("firmada", "registrada", "clasificada", "finalizada")<br/>	return editable<br/>}              		</pre>            	</td>          </tr>                            <tr id="section-10">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-10">&#182;</a>              		</div>                 	/*  * Permisos de la pagina de presentacion */            	 	</td>            	<td class="code">            		<pre>              		</pre>            	</td>          </tr>                            <tr id="section-11">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-11">&#182;</a>              		</div>                 	            	 	</td>            	<td class="code">            		<pre>Permiso mensajeVerificacion{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor") and<br/>		solicitud?.estado = "requerida plazo vencido"<br/>	return leer<br/>}<br/><br/>Permiso iniciarVerificacion{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor") and<br/>		solicitud?.estado = "iniciada"<br/>	return all<br/>}<br/><br/>Permiso verificarDocumentos{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>		when<br/>			agente.rolActivo in ("administrador", "gestor", "revisor") and<br/>			solicitud?.estado = "en verificacion"<br/>		return all<br/><br/>		when<br/>			agente.rolActivo in ("administrador", "gestor", "revisor") and<br/>			solicitud?.estado in ("requerida", "pendiente requerimiento", "requerida plazo vencido", "en verificacion")<br/>		return leer<br/>}<br/><br/>Permiso verificacionRequerimientos{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor") and<br/>		solicitud?.estado in ("en verificacion", "pendiente requerimiento", "requerida", "requerida plazo vencido", "verificada", "excluido", "plazo vencido")<br/>	return all<br/>}<br/><br/>Permiso nuevoRequerimiento{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor") and<br/>		solicitud?.estado = "pendiente requerimiento"<br/>	return all<br/>}<br/><br/>Permiso firmarRequerimiento{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		solicitud?.estado = "pendiente requerimiento" and<br/>		agente.rolActivo in ("administrador", "gestor")<br/>	return all<br/><br/>	when<br/>		solicitud?.estado = "pendiente requerimiento"<br/>		and<br/>		agente.rolActivo in ("administrador", "gestor", "revisor")<br/>	return leer<br/>}<br/><br/>Permiso finalizarRequerimiento{<br/>	vars<br/>		SolicitudGenerica solicitud<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor") and<br/>		solicitud?.estado in ("requerida", "requerida plazo vencido")<br/>	return all <br/>}<br/><br/>Permiso aportacionNoNull{<br/>	vars<br/>		Documento doc<br/>	when<br/>		doc.uri = null<br/>	return editable<br/>}<br/><br/>Permiso nuevaSolicitud{<br/>	vars<br/>		Convocatoria convocatoria<br/>	when<br/>		convocatoria.estado = "presentacion"<br/>	return all<br/>}<br/>              		</pre>            	</td>          </tr>                            <tr id="section-12">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-12">&#182;</a>              		</div>                 	<p>Baremación	</p>            	 	</td>            	<td class="code">            		<pre>Permiso listaEvaluaciones{<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor")<br/>	return editable<br/>}<br/><br/>Permiso evaluacion{<br/>	when<br/>		agente.rolActivo in ("administrador", "gestor", "revisor")<br/>	return all<br/>}<br/><br/>Permiso tableKeyOnlyEstadosSolicitud{<br/>	vars<br/>		TableKeyValue tableKeyValue<br/>	when<br/>		tableKeyValue.table = "estadosSolicitud" and<br/>		agente.rolActivo = "administrador"<br/>	return all<br/>}<br/><br/>Permiso tableKeyOnlyEstadosSolicitudUsuario{<br/>	vars<br/>		TableKeyValue tableKeyValue<br/>	when<br/>		tableKeyValue.table = "estadosSolicitudUsuario" and<br/>		agente.rolActivo = "administrador"<br/>	return editable<br/>}<br/>              		</pre>            	</td>          </tr>                            <tr id="section-13">            	<td class="docs">              		<div class="pilwrap">                		<a class="pilcrow" href="#section-13">&#182;</a>              		</div>                 	<p>Editable administrador Visible para el usuario</p>            	 	</td>            	<td class="code">            		<pre>Permiso editAdminVisibleUser {<br/>	when<br/>		administrador is visible<br/>	return all<br/><br/>	when<br/>		usuario is visible<br/>	return visible<br/>}              		</pre>            	</td>          </tr>              </tbody>    </table>  </div>  <script>        	$('pre').addClass("prettyprint");	$('pre').css('overflow', 'auto');    prettyPrint();  </script></body>