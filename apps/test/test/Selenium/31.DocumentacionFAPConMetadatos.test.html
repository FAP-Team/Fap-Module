%{
// Obtenemos al ultima solicitud, sobre la que trabajamos
models.Solicitud s = models.Solicitud.all().fetch().get((int)models.Solicitud.count()-1);

play.mvc.Controller.session.put("username", "admin");
controllers.fap.AgenteController.findAgente();
}%

#{selenium}
    open(/Principal/solicitudes)
    waitForPageToLoad()
    pause(1000)   // Necesaria para la carga de solicitudes
    open('/Solicitud/solicitantepfcamposno?idSolicitud=${s.id}&accion=editar')
    waitForPageToLoad()
    clickAndWait('link=Documentación FAP')
    clickAndWait('//button')
    select('id=documento_tipo','label=Aportación de la solicitud')
%{
if (properties.FapProperties.getBoolean("fap.metadatos.activo")) {
}%
        assertElementPresent('id=botonRellenarMetadatos')
        click('id=botonRellenarMetadatos')
        pause('5000')
        assertElementPresent('id=BotonGuardarPopupMetadatos')
        type('id=metadatos_nombre','valorMetadatoTest')
        click('id=BotonGuardarPopupMetadatos')
        assertElementPresent('css=#formHiddenMetadatos > input:nth-child(1)','valorMetadatoTest')
%{} else {}%
        assertElementNotPresent('id=botonRellenarMetadatos')
%{}}%
#{/selenium}

