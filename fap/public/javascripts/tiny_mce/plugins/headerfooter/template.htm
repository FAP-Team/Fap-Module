<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>{#template_dlg.title}</title>
	<script type="text/javascript" src="../../tiny_mce_popup.js"></script>
	<script type="text/javascript" src="js/template.js"></script>
	<link href="css/template.css" rel="stylesheet" type="text/css" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js" type="text/javascript"></script>
</head>

<body onresize="HeaderFooterDialog.resize();"> 
    <script>
            // Recogemos los datos del json devuelto por el controlador insertarImagen, para crear las
            // <option> del <select>. En el value del option concatenamos (separado por una coma) 
            // el id de la plantilla y la ruta de la misma
            $.getJSON('/plantillasdoccontroller/insertarPlantilla', function(data) {   
	             $.each(data, function(key,value) {
	                    $("#header").append('<option id="h' + value.idPlantilla + '" value="' + value.idPlantilla + "," + value.ruta + '">' + value.nombrePlantilla + '</option>');
	                    $("#footer").append('<option id="f' + value.idPlantilla + '" value="' + value.idPlantilla + "," + value.ruta + '">' + value.nombrePlantilla + '</option>');
	             });  
	        });
	        
            // Hallamos qu√© header y footer tiene la plantilla actual para mostrarla por defecto
            //tinyMCE.editors[0].execCommand('existeIdPlantillaURL');
            //console.log("[template.htm] tinyMCEPopup.editor.plantillaEnEditor = " + tinyMCEPopup.editor.plantillaEnEditor);
            $.getJSON('/plantillasdoccontroller/getHeaderFooter', {'idPlantilla' : tinyMCEPopup.editor.plantillaEnEditor}, function(data) { 
                   $.each(data, function(index,value) {
                        if (value.idHeader != "null") {
                            $("#h" + value.idHeader).attr('selected', 'selected');
                            var optionValue =  $("#h" + value.idHeader).attr("value");
                            HeaderFooterDialog.selectTemplate( getRuta(optionValue), "", "header" );
                        }
                        if (value.idFooter != "null") {
                            $("#f" + value.idFooter).attr('selected', 'selected');
                            var optionValue =  $("#f" + value.idFooter).attr("value");
                            HeaderFooterDialog.selectTemplate( getRuta(optionValue), "", "footer" );
                        }     
                   });  
            });
	       
	        // Obtenemos la ruta del value del option actualmente seleccionado en el select
	        function getRuta(value) {
	            return value.split(",")[1];
	        }
    </script>


	<form onsubmit="HeaderFooterDialog.insert();return false;">
		<div id="frmbody">
			<div class="title">Elegir cabecera y pie para la plantilla actual</div>
			<div class="frmRow">
			<label for="header" title="header_label">Cabecera:</label>
			<select id="header" name="header" onchange="HeaderFooterDialog.selectTemplate(getRuta(this.options[this.selectedIndex].value), this.options[this.selectedIndex].text, 'header');" class="mceFocus">
				<option value="">{#template_dlg.select}...</option>
			</select>
			<span id="warning"></span>
			</div>
			<!--<div class="frmRow"><label for="tdesc">{#template_dlg.desc_label}:</label>
			<span id="tmpldesc"></span></div>-->
			<fieldset>
				<legend>{#template_dlg.preview}</legend>
				<iframe id="templatesrc_header" name="templatesrc_header"  width="690" height="175" frameborder="0"></iframe>
			</fieldset>
			
			<br /><br /><br />
			
			<div class="frmRow">
			<label for="footer" title="footer_label">Pie:</label>
		    <select id="footer" name="footer" onchange="HeaderFooterDialog.selectTemplate(getRuta(this.options[this.selectedIndex].value), this.options[this.selectedIndex].text, 'footer');" class="mceFocus">
				<option value="">{#template_dlg.select}...</option>
			</select>
			<span id="warning"></span>
			</div>
			<fieldset>
				<legend>{#template_dlg.preview}</legend>
				<iframe id="templatesrc_footer" name="templatesrc_footer"  width="690" height="175" frameborder="0"></iframe>
			</fieldset>
		</div>
		
		<div class="mceActionPanel">
			<input type="submit" id="insert" name="insert" value="Guardar" />
			<input type="button" id="cancel" name="cancel" value="{#cancel}" onclick="tinyMCEPopup.close();" />
		</div>
	</form>
</body> 
</html> 
