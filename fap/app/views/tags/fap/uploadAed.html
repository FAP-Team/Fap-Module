%{ def obj = _obj ?: _caller.get(_campo.split("\\.")[0])}%

#{fap.field _campo, obj:obj}
%{ 
	def id = _id ?: field.id
	def requerido = _requerido != null? _requerido : false;
	def campo = _campo
	def tipo = _tipo != null? _tipo : "tipo";
	def campoTipo = "${campo}.${tipo}";
	def campoDescripcion = campo + ".descripcion"
	def comboId = id + "_tipo";
	def oldComboId = field.id + "_tipo";
	def tipoDocumentoOtros = properties.FapProperties.get("fap.aed.tiposdocumentos.otros");
	def upload = _upload != null? _upload : true
	def download = _download != null? _download : false
	def tramite = _tramite
	def aportadoPor = _aportadoPor
}%	

	%{
		def tiposDocumentos
		if (tramite == null){
			if (aportadoPor == null)
				tiposDocumentos = models.TipoDocumento.findAll();
			else
				tiposDocumentos = models.Tramite.findTipoDocumentosAportadosPor(aportadoPor);
		}else if(aportadoPor == null){
			tiposDocumentos = models.Tramite.findTipoDocumentosFrom(tramite);
		}else{
			tiposDocumentos = models.Tramite.findTipoDocumentosAportadosPor(tramite, aportadoPor);
		}
	}%

	#{fap.combo id:comboId, idOld:oldComboId, campo:campoTipo, titulo:"Tipo de documento", itemsModificables:tiposDocumentos, comboValue:"uri", comboText:"nombre", obj:obj, requerido:requerido, eliminarDuplicados:true, ancho:"450px", ordenarPorTexto:true/}
	
	#{fap.grupo visible:false, siCombo:comboId, siComboValue:[tipoDocumentoOtros], siComboReverse:true}
		#{fap.texto campo:campoDescripcion, titulo:"Descripci√≥n", obj:obj, requerido:requerido /}
	#{/fap.grupo}
	
	#{if upload}
		#{fap.upload id:id /}
	#{/if}
	
	#{if download}
		<div class="form-row">
			<a href="${obj.urlDescarga}" target="_blank" class="boton">Descargar documento desde el AED</a>
		</div>
	#{/if}
	
#{/fap.field}