*{
	Fecha
	=====================================
	_id			- ID
	_titulo		- Label
	_value 		- Valor a mostrar, si no se especifica busca el valor del campo
	_campo		- Campo donde se almacenar√° el texto
	_ayuda		- Objeto del tipo TagAyuda
	_requerido(false)	- El campo es requerido
	_obj		- Objeto a partir del cual se accede al value. 
    		   	  Usar en el caso de que se llame desde otro tag.
 	_noRow(false)	- true para no envolver el campo en un form-row

}*

%{ def obj = _obj ?: _caller.get(_campo.split("\\.")[0])}%

#{fap.field _campo, obj:obj}

%{ 
	def id = _id ?: field.id
	def label = _titulo ?: field.name
	def value = _value ?: field.flashorvalue
	if(value instanceof org.joda.time.DateTime) //Formatea la fecha
		value = value.format()
		
	def ayuda = _ayuda
	def requerido = _requerido != null? _requerido : false;
	def stackDisabled = tags.TagMapStack.top("editable")
	def disabled = stackDisabled == null || stackDisabled? '' : 'disabled="disabled"'
	def showRow   = _noRow != null? !_noRow : true
	
	def propertyFormatDate = properties.FapProperties.get("date.format") ?: null;
	def formatDate = "";
	if ((propertyFormatDate != null) && (!propertyFormatDate.equals("dd/MM/yyyy"))){
		formatDate = propertyFormatDate.replace("yyyy", "yy");
		formatDate = "dateFormat: '" + formatDate + "'"
		formatDate = formatDate.toLowerCase();
	}
	play.Logger.debug("Format Date: "+formatDate);
	
}%


#{fap.texto id:id, titulo:label, value:value, campo:field.name, fecha:true, ayuda:ayuda, requerido:requerido, obj:obj}
#{/fap.texto}
	
	<script type="text/javascript">

    function disableWeekends($this) {
        var $days = $this.find('.datepicker-days tr').each(function() {
            var $days = $(this).find('.day');
            // disable Sunday
            $days.eq(0).addClass('old').click(false);
            // disable Saturday
            $days.eq(6).addClass('old').click(false);
        });

    }

    $('#${id}').datepicker(${formatDate});

    // get instance of the jQuery object created by
    // datepicker    
    var datepicker = $('#${id}').data('datepicker');

    // disable weekends in the pre-rendered version
    disableWeekends(datepicker.picker);

    // disable weekends whenever the month changes
    var _fill = datepicker.fill;
    datepicker.fill = function() {
        _fill.call(this);
        disableWeekends(this.picker);
    };


	</script>


#{/fap.field}